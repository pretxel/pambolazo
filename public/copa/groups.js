define(['lang=es/main'],function () {;(function($,w,d) {var standingsView=fifa.view.extend({matchesLoaded:{},initialize:function(options) {var _this=this;_this.jqXHR=null;_this.timeConverter=null;fifa.view.prototype.initialize.apply(_this,[options]);},toggleMatches:function(row) {if(row.next().is(".hidden")) {row.find("span.glyphicon-chevron-down").attr("class","glyphicon-remove");row.next().removeClass("hidden");var subvars={};var $item=row.parents('div.row').eq(0).find('script[type="analytics-override"]').eq(0);if($item.length>0) {itemcontent=$item.html().match(/\*([^*]*)\*/)[1];var itemobj=$.parseJSON(itemcontent);subvars=itemobj;}subvars.contenttype="list-matches";var $nrow=row.next();}else {row.find("span.glyphicon-remove").attr("class","glyphicon-chevron-down");row.next().addClass("hidden");}},onItemClick:function(event) {var _this=this,$this=$(event.currentTarget);if(!$this.find('.tbl-expand').is(':visible')) {return;}event.preventDefault();var timeConverterUrl="'/_inc/_timeconverter.html'";timeConverterUrl=timeConverterUrl.replace(/'/g,"");var requestedUrl=$this.data('url');if(_this.jqXHR) {_this.jqXHR.abort();}if(!_this.matchesLoaded[requestedUrl]) {if(!_this.timeConverter) {$.get(timeConverterUrl,function(dt) {_this.timeConverter=dt;});}_this.jqXHR=$.get(requestedUrl.withIgn(),function(data) {_this.matchesLoaded[requestedUrl]=true;var teamModules=$(data).find("div.module[id^='teamId']");if(teamModules.length>0) {_this.filterGroupMatches(_this,teamModules,data);}else {_this.filterKOMatches(_this,data);}_this.toggleMatches($this);});}else {_this.toggleMatches($this);}},filterGroupMatches:function(_this,teamModules,data) {teamModules.each(function(index,teamModule) {var moduleIdTeam=$(teamModule).attr("id").replace("teamId","");var teamCell=_this.$("td[data-idteam='" + moduleIdTeam + "']");$(".mu-more",teamModule).parent().remove();$(".mu:last",teamModule).css({ border:0});teamCell.append(_this.timeConverter);fifa.dispatcher.trigger('core:ajaxReinit');teamCell.append($(".mu",teamModule));_this.triggerMe('matchesLoaded');});},filterKOMatches:function(_this,data) {var rows=$("tr[data-filter]");rows.each(function() {var _row=$(this);var dataFilter=_row.attr("data-filter");var teamModules=$(data).find("div.result");var teamCell=_row.next(".expandcol").find("td");var colspan=_row.find("td").length;teamCell.attr("colspan",colspan);teamModules.each(function(index,teamModule) {var moduleIdTeam=$(teamModule).attr("id");var filterMatches=dataFilter.split('|');if($.inArray(moduleIdTeam.toString(),filterMatches)!=-1) {$(".mu-more",teamModule).parent().remove();$(".mu:last",teamModule).css({ border:0});fifa.dispatcher.trigger('core:ajaxReinit');teamCell.append($(teamModule));_this.triggerMe('matchesLoaded');}});});},events:{'click tr[data-url]':'onItemClick'},coreOnReinit:function() {this.setElement(__cfg.el);},coreOnAjaxDataRequire:function() {this.setElement(__cfg.el);},moduleViewOnItemLoaded:function() {this.setElement(__cfg.el);},name:'standings:view'}),getElement=function() {return __cfg.el;},__cfg={el:"table",bind:['core:reinit','core:ajaxDataRequire','module:view:itemLoaded']};w.views.standings=new standingsView(__cfg);}(window.jQuery||window.jm,window,document)); });
